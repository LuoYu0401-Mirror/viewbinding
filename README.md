# A Simple ViewBinding Tool For Gtk Application

## Usage

This tool will generate view binding code for gtk application based on the provided UI definition file (XML format).

### Step 1: Define Your UI
Create a UI definition file in XML format. For example, create a file named `window.ui`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!-- SPDX-License-Identifier: LGPL-3.0-or-later -->
<interface>
    <template class="ExampleAppWindow" parent="GtkApplicationWindow">
        <property name="title" translatable="yes">Example Application</property>
        <property name="default-width">600</property>
        <property name="default-height">400</property>
        <child type="titlebar">
            <object class="GtkHeaderBar" id="header">
                <child type="title">
                    <object class="GtkStackSwitcher" id="tabs">
                        <property name="stack">stack</property>
                    </object>
                </child>
                <child type="end">
                    <object class="GtkMenuButton" id="gears">
                        <property name="direction">none</property>
                    </object>
                </child>
                <child type="end">
                    <object class="GtkToggleButton" id="search">
                        <property name="sensitive">0</property>
                        <property name="icon-name">edit-find-symbolic</property>
                    </object>
                </child>
            </object>
        </child>
        <child>
            <object class="GtkBox" id="content_box">
                <property name="orientation">vertical</property>
                <child>
                    <object class="GtkSearchBar" id="searchbar">
                        <child>
                            <object class="GtkSearchEntry" id="searchentry">
                                <signal name="search-changed" handler="search_text_changed"/>
                            </object>
                        </child>
                    </object>
                </child>
                <child>
                    <object class="GtkStack" id="stack">
                        <signal name="notify::visible-child" handler="visible_child_changed"/>
                    </object>
                </child>
            </object>
        </child>
    </template>
</interface>
```

### Step 2: Run the ViewBinding Tool
Use the ViewBinding tool to generate the binding code. Run the following command in your terminal:
```bash
viewbinding-generate -a org_ly_view_binding -d ui_file_dir -o output_dir
```
then you will get a generated file named `window_viewbinidng.h` in the specified output directory. Like this:

```c
/* Generated By View Binding Code Generator, Do Not Edit By Hand */

#ifndef org_ly_view_binding_window_VIEW_BINDING_H_
#define org_ly_view_binding_window_VIEW_BINDING_H_

#ifndef VIEW_BINDING_INSIDE_UTILS
#define VIEW_BINDING_INSIDE_UTILS

#define view_binding_full(widget_class, WidgetType, BindingType, binding_name, widget_name) \
	gtk_widget_class_bind_template_child_full(GTK_WIDGET_CLASS(widget_class), #widget_name, FALSE, G_STRUCT_OFFSET(WidgetType, binding_name) + G_STRUCT_OFFSET(BindingType, widget_name));

#define view_binding_full_private(widget_class, WidgetType, BindingType, binding_name, widget_name) \
	gtk_widget_class_bind_template_child_full(GTK_WIDGET_CLASS(widget_class), #widget_name, FALSE, G_PRIVATE_OFFSET(WidgetType, binding_name) + G_STRUCT_OFFSET(BindingType, widget_name));

#endif /* VIEW_BINDING_INSIDE_UTILS */

/* Class Bindings */
typedef struct {
	GtkHeaderBar *header;
	GtkStackSwitcher *tabs;
	GtkMenuButton *gears;
	GtkToggleButton *search;
	GtkBox *content_box;
	GtkSearchBar *searchbar;
	GtkSearchEntry *searchentry;
	GtkStack *stack;
} WindowBinding;

#define window_view_binding(widget_class, WidgetType, binding_name) \
	do { \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, header) \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, tabs) \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, gears) \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, search) \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, content_box) \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, searchbar) \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, searchentry) \
		view_binding_full(widget_class, WidgetType, WindowBinding, binding_name, stack) \
	} while(0) 

#define window_view_binding_private(widget_class, WidgetType, binding_name) \
	do { \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, header) \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, tabs) \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, gears) \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, search) \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, content_box) \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, searchbar) \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, searchentry) \
		view_binding_full_private(widget_class, WidgetType, WindowBinding, binding_name, stack) \
	} while(0) 

/* Signal Handlers */
#define window_view_binding_callback(widget_class) \
	do { \
		gtk_widget_class_bind_template_callback(GTK_WIDGET_CLASS(widget_class), search_text_changed); \
		gtk_widget_class_bind_template_callback(GTK_WIDGET_CLASS(widget_class), visible_child_changed); \
	} while(0) 

#endif /* org_ly_view_binding_window_VIEW_BINDING_H_ */
```

### Step 3: Integrate Generated Code
Include the generated header file in your Gtk application and use the bindings as needed.
```c
#include "window_viewbinding.h"

struct _ExampleAppWindow {
    GtkApplicationWindow parent_instance;

    WindowBinding binding;
};

static void search_text_changed(GtkEntry *entry, ExampleAppWindow *win);
static void visible_child_changed(GObject *stack, GParamSpec *pspec, ExampleAppWindow *win)

static void example_app_window_class_init(ExampleAppWindowClass *klass) {
    gtk_widget_class_set_template_from_resource(GTK_WIDGET_CLASS(klass), "/org/ly/view_binding/window.ui");

    window_view_binding(GTK_WIDGET_CLASS(klass), ExampleAppWindow, binding);
    window_view_binding_callback(GTK_WIDGET_CLASS(klass));
}
```
